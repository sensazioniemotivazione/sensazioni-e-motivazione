<!DOCTYPE html>
<html lang="it">
<head>
  <meta property="og:title" content="Sensazioni e Motivazione">
<meta property="og:description" content="Il sito motivazionale per ispirarti ogni giorno.">
<meta property="og:image" content="https://sensazioniemotivazione.com/immagini_sitomotivazionale/copertinasito.JPEG">
<meta property="og:url" content="https://sensazioniemotivazione.com">
<meta name="twitter:card" content="summary_large_image">                                                  
<link rel="icon" type="image/png" href="immagini_sitomotivazionale/favicon.png">
  <meta charset="utf-8" />
  <title>Lampada dell’Umore</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Segoe UI', Tahoma, system-ui, sans-serif;
      background:#000; color:#e6e8ee;
    }

    /* 🔹 Navbar */
nav {
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  background: rgba(0,0,0,0.6);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 20px;
  z-index: 1000;
}

nav{ transition: opacity .5s ease; }
.nav-hidden{ opacity:0; pointer-events:none; }

/* 🔹 Logo */
.logo {
  display: flex;
  align-items: center;
}

.logo img {
  height: 50px;   /* regola la dimensione */
  width: auto;
  display: block;
  cursor: pointer;
  transition: transform 0.3s ease;
}

.logo img:hover {
  transform: scale(1.05);
}

/* 🔹 Pulsanti accedi/registrati */
#authArea {
  display: flex;
  align-items: center;
  gap: 12px;
}

#authArea button {
  background: transparent;
  border: 2px solid #0ea5e9;
  color: #0ea5e9;
  padding: 6px 16px;
  border-radius: 25px;
  cursor: pointer;
  font-size: 0.85em;
  font-weight: 600;
  transition: all 0.3s ease;
}

#authArea button:hover {
  background: #0ea5e9;
  color: #fff;
  transform: translateY(-2px);
}

#authArea button:active {
  transform: translateY(0);
}
    .hamburger {
  position: fixed;
  top: 15px;
  left: 15px;
  width: 30px;
  height: 22px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  cursor: pointer;
  z-index: 1100; /* sopra la topbar */
}

.hamburger span {
  display: block;
  height: 4px;
  background: #fff; /* linee bianche visibili */
  border-radius: 2px;
  transition: all 0.3s ease;
}

    /* Menu nascosto */
.topbar {
  position: fixed;
  top: 0;
  left: -250px;   /* nascosto fuori dallo schermo */
  width: 250px;
  height: 100%;
  background: rgba(0,0,0,0.9);
  backdrop-filter: blur(8px);
  display: flex;
  flex-direction: column;
  padding: 60px 20px;
  gap: 15px;
  transition: left 0.3s ease;
  z-index: 1000;


  overflow-y: auto;              /* 👈 abilita scroll */
  -webkit-overflow-scrolling: touch; /* 👈 scroll fluido su mobile */
}

.topbar.open {
  left: 0; /* quando si apre */
}

.topbar a {
  text-decoration: none;
  color: #fff;
  background: #2d2d2d;   /* grigio scuro neutro */
  padding: 10px 14px;
  border-radius: 8px;
  font-weight: 600;
  transition: background 0.2s;
}

.topbar a:hover {
  background: #444;      /* leggermente più chiaro in hover */
}

    .navlink{
      text-decoration:none; color:#fff; font-weight:600;
      background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.15);
      padding:10px 16px; border-radius:10px; transition:transform .2s, background .2s;
    }
    .navlink:hover{ transform:translateY(-2px); background:rgba(255,255,255,.18) }
    .navlink.primary{ background:#0ea5e9; border-color:transparent }
    .navlink.primary:hover{ background:#38bdf8 }

    /* Hero coerente */
    header{
      min-height:44vh; position:relative; display:flex; align-items:center; justify-content:center; text-align:center;
      padding:40px 20px;
      background:url('immagini_sitomotivazionale/sss.jpg') center/cover no-repeat;
    }
    header::after{ content:""; position:absolute; inset:0; background:linear-gradient(to bottom, rgba(0,0,0,.35), rgba(0,0,0,.75)); }
    .hero-wrap{ position:relative; z-index:1; max-width:900px; }
    h1{ font-size:2.2em; text-shadow:2px 2px 6px rgba(0,0,0,.6) }
    .subtitle{ margin-top:10px; font-size:1.05em; color:#ddd }

    /* Contenitore principale vetroso */
    main{ max-width:1000px; margin:36px auto 70px; padding:0 20px; }
    .card{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      backdrop-filter:blur(10px);
      border-radius:20px; padding:28px;
      box-shadow:0 20px 60px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.03);
    }
    .desc{ margin:0 0 14px; color:#bfc5d0 }

    /* Layout interno */
    .wrap{ display:grid; grid-template-columns: 1fr 1fr; gap:28px; align-items:center; }
    @media (max-width:900px){ .wrap{ grid-template-columns:1fr } }

    .svgbox{
      display:flex; align-items:center; justify-content:center; padding:18px;
      background:#0b0e13; border-radius:16px; border:1px solid #1f2432;
    }
    svg{ width:min(360px, 80vw); height:auto; cursor:pointer; user-select:none; -webkit-tap-highlight-color:transparent; }
    .base{ fill:#2b3142 }
    .bulb{ transition:fill .25s ease, filter .25s ease }
    .rays line{ stroke-width:6; stroke-linecap:round; opacity:0; transition:opacity .25s ease }
    .lamp.on .bulb{ fill:#ffd54f; filter: drop-shadow(0 0 22px rgba(255,213,79,.45)) drop-shadow(0 0 60px rgba(255,213,79,.25)); }
    .lamp.off .bulb{ fill:#3b4050; }
    .lamp.on .rays line{ opacity:.9 }

    /* Stat box */
    .stat{
      padding:18px; border:1px solid rgba(255,255,255,.12);
      border-radius:16px; background:rgba(255,255,255,.04);
    }
    .kpis{ display:flex; gap:12px; align-items:baseline; flex-wrap:wrap; margin:6px 0 10px; }
    .kpi{ font-weight:800 }
    .kpi.good{ color:#84d65a } .kpi.bad{ color:#ff6b6b }
    .badge{ font-size:12.5px; padding:6px 8px; border:1px solid rgba(255,255,255,.18); border-radius:8px; color:#b7bdc8 }
    .warn{ color:#ffd666 }

    /* Progress bar coerente */
    .bar{ height:12px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:999px; overflow:hidden }
    .bar > div{ height:100%; width:0%; transition:width .35s ease }
    .onSeg{ background:linear-gradient(90deg, #0ea5e9, #38bdf8) }

    /* CTA coerenti sito */
    .cta{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:12px }
    .btn{
      border:0; padding:12px 16px; border-radius:12px; font-weight:700; letter-spacing:.2px; cursor:pointer;
      background:#111827; color:#e6e8ee; border:1px solid rgba(255,255,255,.12); transition:.2s transform ease, .2s background ease;
    }
    .btn:hover{ transform:translateY(-2px); background:#172033 }
    .btn.on{ background:rgba(255,213,79,.12); border-color:rgba(255,213,79,.25) }
    .btn.off{ background:rgba(80,94,120,.12); border-color:rgba(80,94,120,.25) }

    footer{ margin:60px 0 30px; text-align:center; color:#a7afba; font-size:.95em }

#loginPopup {
      display:none;
      position:fixed;
      top:0; left:0;
      width:100%; height:100%;
      background:rgba(0,0,0,0.7);
      z-index:2000;
      justify-content:center;
      align-items:center;
    }
    #loginPopup > div {
      background:#fff; 
      color:#000; 
      padding:30px; 
      border-radius:12px; 
      max-width:400px; 
      text-align:center;
      box-shadow:0 8px 20px rgba(0,0,0,0.4);
    }
    #loginPopup p { font-size:1.2em; margin-bottom:20px; }
    #closePopupBtn {
      padding:10px 20px; 
      border:none; 
      border-radius:8px; 
      background:#0ea5e9; 
      color:#fff; 
      font-weight:bold; 
      cursor:pointer;
    }

    /* --- Modal Base --- */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.8);
  justify-content: center;
  align-items: center;
  z-index: 3000;
}
.modal-content {
  background: #111;
  padding: 30px;
  border-radius: 12px;
  max-width: 400px;
  width: 90%;
  text-align: center;
  color: #fff;
  position: relative;
}
.modal-content input {
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  border-radius: 6px;
  border: none;
}
.modal-content button {
  width: 100%;
  padding: 10px;
  background: #2563eb;
  border: none;
  color: #fff;
  font-weight: bold;
  border-radius: 6px;
  cursor: pointer;
}
.modal-content button:hover { background:#3b82f6; }
.close {
  position: absolute;
  top: 15px;
  right: 20px;
  font-size: 1.5em;
  cursor: pointer;
  color: #fff;
}
#loginMsg,#registerMsg{margin-top:10px;font-size:.9em;}

  </style>
</head>
<body>

<nav>
  <div class="logo">
    <img src="immagini_sitomotivazionale/logo.PNG" alt="Logo">
  </div>
  <div id="authArea">
    <button id="loginBtn">Accedi</button>
    <button id="registerBtn">Registrati</button>
  </div>
</nav>

<!-- 🔑 Modale Login -->
<div id="loginModal" class="modal">
  <div class="modal-content">
    <span class="close" data-close="loginModal">&times;</span>
    <h2>Accedi</h2>
    <form id="loginForm">
      <input type="email" id="loginEmail" placeholder="Email" required>
      <input type="password" id="loginPassword" placeholder="Password" required>
      <button type="submit">Accedi</button>
      <p id="loginMsg"></p>
    </form>
  </div>
</div>

<!-- 🔑 Modale Registrazione -->
<div id="registerModal" class="modal">
  <div class="modal-content">
    <span class="close" data-close="registerModal">&times;</span>
    <h2>Registrati</h2>
    <form id="registerForm">
      <input type="email" id="registerEmail" placeholder="Email" required>
      <input type="password" id="registerPassword" placeholder="Password" required>
      <button type="submit">Registrati</button>
      <p id="registerMsg"></p>
    </form>
  </div>
</div>

<!-- 🔔 Popup Logout -->
<div id="logoutModal" class="modal">
  <div class="modal-content">
    <span class="close" data-close="logoutModal">&times;</span>
    <h2>Logout effettuato</h2>
    <p>Sei uscito dal tuo account con successo.</p>
    <button id="logoutOkBtn">Chiudi</button>
  </div>
</div>

    <!-- Pulsante hamburger -->
<div class="hamburger">
  <span></span>
  <span></span>
  <span></span>
</div>

  <!-- Menu -->
  <div class="topbar">
   <a href="index.html" class="btn">← Torna alla Home</a>
<a href="storie-motivazionali-personaggi-famosi.html" class="btn">← Leggi la storia di chi ce l’ha fatta</a>
<a href="interpreta-i-tuoi-sogni.html" class="btn">← Impara ad interpretare i tuoi sogni</a> 
<a href="scrivi-il-tuo-obiettivo.html" class="btn">← Scrivi il tuo obiettivo con il mondo</a>
<a href="paure-umane.html" class="btn">← Scopri le tue paure</a>
<a href="invenzioni-incredibili-dell-uomo.html" class="btn">← Leggi invenzioni ed idee</a>
<a href="abitudini-comuni-umane.html" class="btn">← Sfoglia l’elenco delle abitudini più comuni dell’uomo</a>
<a href="la-gara-contro-il-tempo.html" class="btn">← Sfida te stesso</a>
<a href="coming-soon.html" class="btn">← COMING SOON</a>
<a href="contatta-il-creatore.html" class="btn">← Contatta il creatore</a>
<a href="https://www.paypal.me/christianLenti" class="btn">← Offri supporto al creatore</a>
  </div>

  <!-- Hero -->
  <header>
    <div class="hero-wrap">
      <h1>Lampada dell’umore</h1>
      <p class="subtitle">Accendi se ti senti sereno, spegni se ti senti giù. La percentuale è globale e si aggiorna in tempo reale.</p>
    </div>
  </header>

  <!-- Pannello vetroso -->
  <main>
    <div class="card">
      <p class="desc">Ogni clic aggiorna la percentuale vista da tutti. Una preferenza per account, ma puoi cambiare idea e il conteggio si adatta.</p>

      <div class="wrap">
        <div class="svgbox">
          <!-- SVG e classi/ID invariati per non toccare la logica -->
          <svg id="lampSvg" class="lamp off" viewBox="0 0 300 420" role="button" aria-label="Lampada cliccabile" tabindex="0">
            <defs>
              <linearGradient id="neck" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0" stop-color="#3a4154"/><stop offset="1" stop-color="#2a3045"/>
              </linearGradient>
            </defs>
            <g>
              <rect class="base" x="110" y="300" rx="10" ry="10" width="80" height="36"></rect>
              <rect fill="url(#neck)" x="118" y="264" rx="10" ry="10" width="64" height="40"></rect>
              <circle class="bulb" cx="150" cy="180" r="110"></circle>
              <g class="rays" stroke="#ffd54f">
                <line x1="150" y1="22"  x2="150" y2="2"/>
                <line x1="150" y1="338" x2="150" y2="358"/>
                <line x1="270" y1="180" x2="290" y2="180"/>
                <line x1="10"  y1="180" x2="30"  y2="180"/>
                <line x1="240" y1="90"  x2="256" y2="74"/>
                <line x1="44"  y1="286" x2="28"  y2="302"/>
                <line x1="60"  y1="88"  x2="44"  y2="72"/>
                <line x1="256" y1="286" x2="272" y2="302"/>
              </g>
            </g>
          </svg>
        </div>

        <div class="stat">
          <div class="kpis">
            <span id="happyPct" class="kpi good">Felicità — 0%</span>
            <span id="sadPct"   class="kpi bad">Tristezza — 0%</span>
            <span id="totVotes" class="badge">0 voti totali</span>
            <span id="status"   class="badge warn">Configura Firebase</span>
          </div>

          <div class="bar" aria-hidden="true">
            <div id="barOn" class="onSeg"></div>
          </div>

          <div class="cta">
            <button id="btnOn"  class="btn on">Mi sento luminoso (accendo)</button>
            <button id="btnOff" class="btn off">Mi sento buio (spengo)</button>
          </div>
        </div>
      </div>
    </div>
  </main>

<footer>
    <p>&copy; 2025 Sensazioni e Motivazione - Tutti i diritti riservati</p>
  </footer>
  <!-- Popup login -->
<div id="loginPopup">
  <div>
    <p>⚠️ Devi accedere o registrarti per poter votare.</p>
    <button id="closePopupBtn">Continua</button>
  </div>
</div>

  <!-- Firebase (Compat SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <script>
/* 🔑 Config invariata */
const firebaseConfig = {
  apiKey: "AIzaSyCYtTpOIpmjd4v-01Z2MPSDiQr6enUFNSg",
  authDomain: "sito-motivazionale.firebaseapp.com",
  projectId: "sito-motivazionale",
  storageBucket: "sito-motivazionale.firebasestorage.app",
  messagingSenderId: "839022857622",
  appId: "1:839022857622:web:49d4f20245ddafc0f5e1b7",
  measurementId: "G-8H2TBGYYXZ"
};

const els = {
  lamp: document.getElementById('lampSvg'),
  barOn: document.getElementById('barOn'),
  happy: document.getElementById('happyPct'),
  sad: document.getElementById('sadPct'),
  tot: document.getElementById('totVotes'),
  status: document.getElementById('status'),
  btnOn: document.getElementById('btnOn'),
  btnOff: document.getElementById('btnOff'),
};

let db = null, statsRef = null, stateRef = null, unsubStats = null, unsubState = null;

/* --- UI --- */
function uiSetLamp(state){
  els.lamp.classList.toggle('on',  state === 'on');
  els.lamp.classList.toggle('off', state !== 'on');
}
function uiStats(on, off){
  const total = (on|0) + (off|0);
  const pOn = total ? Math.round(on/total*100) : 0;
  const pOff = 100 - pOn;
  els.barOn.style.width = pOn + '%';
  els.happy.textContent = `Felicità — ${pOn}%`;
  els.sad.textContent   = `Tristezza — ${pOff}%`;
  els.tot.textContent   = `${total} voti totali`;
}

/* --- Voto --- */
async function vote(newState){
  const user = firebase.auth().currentUser;
  if(!user){ 
    mostraPopup();   
    return;          
  }

  const uid = user.uid;
  const userRef = db.collection('userVotes').doc(uid);

  await db.runTransaction(async tx => {
    const statsSnap = await tx.get(statsRef);
    const userSnap  = await tx.get(userRef);

    let stats = statsSnap.exists ? statsSnap.data() : { on:0, off:0 };
    let prev  = userSnap.exists ? userSnap.data().vote : null;

    if(prev === newState) return;

    if(prev === null){
      stats[newState] = (stats[newState]||0) + 1;
    } else {
      stats[prev] = Math.max(0, (stats[prev]||0) - 1);
      stats[newState] = (stats[newState]||0) + 1;
    }

    // aggiorna conteggi + stato globale + voto personale
    tx.set(statsRef, stats, { merge:true });
    tx.set(userRef, { vote:newState }, { merge:true });
    tx.set(stateRef, { value:newState, updatedAt: Date.now() }, { merge:true });
  });

  uiSetLamp(newState);
}

/* --- Init Firebase --- */
function initFirebase(){
  firebase.initializeApp(firebaseConfig);
  db = firebase.firestore();
  statsRef = db.collection('lamp').doc('stats');
  stateRef = db.collection('lamp').doc('state');
  els.status.textContent = 'Online';

  // crea doc se non esistono
  statsRef.get().then(s=>{ if(!s.exists) statsRef.set({ on:0, off:0 }) });
  stateRef.get().then(s=>{ if(!s.exists) stateRef.set({ value:'off', updatedAt: Date.now() }) });

  // ascolta stats
  unsubStats = statsRef.onSnapshot(s=>{
    const d = s.data() || { on:0, off:0 };
    uiStats(d.on|0, d.off|0);
  });
}

/* --- Eventi lampada e bottoni --- */
els.lamp.addEventListener('click', ()=>{
  const next = els.lamp.classList.contains('on') ? 'off' : 'on';
  vote(next);
});
els.btnOn.addEventListener('click', ()=> vote('on'));
els.btnOff.addEventListener('click',()=> vote('off'));

/* --- Avvio --- */
(function boot(){
  uiSetLamp('off');
  uiStats(0,0);
  initFirebase();
})();

/* --- Menu hamburger --- */
document.querySelector(".hamburger").onclick = () => {
  document.querySelector(".topbar").classList.toggle("open");
};

/* --- Gestione Auth --- */
function registraUtente(email, password) {
  firebase.auth().createUserWithEmailAndPassword(email, password)
    .then(() => {
      document.getElementById("registerMsg").textContent = "✅ Registrazione completata!";
      setTimeout(() => closeModal("registerModal"), 1500);
    })
    .catch(err => {
      document.getElementById("registerMsg").textContent = "❌ " + err.message;
      setTimeout(() => closeModal("registerModal"), 2000);
    });
}
function loginUtente(email, password) {
  firebase.auth().signInWithEmailAndPassword(email, password)
    .then(() => {
      document.getElementById("loginMsg").textContent = "✅ Login effettuato!";
      setTimeout(() => closeModal("loginModal"), 1500);
    })
    .catch(err => {
      document.getElementById("loginMsg").textContent = "❌ " + err.message;
      setTimeout(() => closeModal("loginModal"), 2000);
    });
}
function logoutUtente() {
  firebase.auth().signOut()
    .then(() => { openModal("logoutModal"); })
    .catch(err => console.error("Errore logout:", err));
}

firebase.auth().onAuthStateChanged(async (user) => {
  const authArea = document.getElementById("authArea");
  if (!authArea) return;

  if (user) {
   const nome = user.email.split('@')[0];  // prende solo la parte prima di @
authArea.innerHTML = `
  <span style="margin-right:10px;">Ciao, ${nome}</span>
  <button id="logoutBtn">Logout</button>
`;
    document.getElementById("logoutBtn").addEventListener("click", logoutUtente);

    // ci pensa sempre stateRef
    if(unsubState) unsubState();
    unsubState = stateRef.onSnapshot(s=>{
      const v = s.exists && s.data().value ? s.data().value : 'off';
      uiSetLamp(v);
    });

  } else {
    authArea.innerHTML = `
      <button id="loginBtn">Accedi</button>
      <button id="registerBtn">Registrati</button>
    `;
    document.getElementById("loginBtn").addEventListener("click", () => openModal("loginModal"));
    document.getElementById("registerBtn").addEventListener("click", () => openModal("registerModal"));

    if(unsubState) unsubState();
    unsubState = stateRef.onSnapshot(s=>{
      const v = s.exists && s.data().value ? s.data().value : 'off';
      uiSetLamp(v);
    });
  }
});

/* --- Popup login rapido --- */
const popup       = document.getElementById("loginPopup");
const closePopup  = document.getElementById("closePopupBtn");
closePopup.onclick = () => popup.style.display = "none";
function mostraPopup(){ popup.style.display = "flex"; }
</script>

<script>
/* --- Navbar auto-hide --- */
const nav = document.querySelector('nav');
let hideTimeout = null;
let lastY = window.scrollY;
let suppressShowUntil = 0;

function scheduleHide(){
  clearTimeout(hideTimeout);
  hideTimeout = setTimeout(()=>{
    nav.classList.add('nav-hidden');
  }, 3000);
}
document.addEventListener('click', ()=> suppressShowUntil = Date.now() + 600);
document.addEventListener('focusin', ()=> suppressShowUntil = Date.now() + 600);

function onScroll(){
  const y = window.scrollY;
  const delta = Math.abs(y - lastY);
  lastY = y;
  if (delta < 8) return;
  if (Date.now() < suppressShowUntil) return;
  nav.classList.remove('nav-hidden');
  scheduleHide();
}
window.addEventListener('scroll', onScroll, { passive: true });
nav.classList.remove('nav-hidden');
scheduleHide();
</script>

<script>
// --- Gestione modali ---
function openModal(id) {
  document.getElementById(id).style.display = "flex";
}
function closeModal(id) {
  document.getElementById(id).style.display = "none";
}

// Chiudi con la "X"
document.querySelectorAll(".close").forEach(el=>{
  el.addEventListener("click", ()=> closeModal(el.dataset.close));
});

// Chiudi con il pulsante "Chiudi" del logout
document.getElementById("logoutOkBtn")
  .addEventListener("click", ()=> closeModal("logoutModal"));

// --- Submit form ---
document.getElementById("loginForm").addEventListener("submit", e=>{
  e.preventDefault();
  // qui richiami la tua funzione loginUtente()
  loginUtente(
    document.getElementById("loginEmail").value,
    document.getElementById("loginPassword").value
  );
});
document.getElementById("registerForm").addEventListener("submit", e=>{
  e.preventDefault();
  // qui richiami la tua funzione registraUtente()
  registraUtente(
    document.getElementById("registerEmail").value,
    document.getElementById("registerPassword").value
  );
});
</script>

</body>
</html>
